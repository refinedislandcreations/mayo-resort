<section
  class="max-w-full mx-auto py-12 md:py-24 lg:py-48 px-4 sm:px-4 md:px-12 lg:px-16 xl:px-20 {{ page.guest_testimonials.bg_color }}"
>
  <div
    id="testimonialWrapper"
    class="relative flex flex-col xs:flex-row items-center justify-center max-w-[96rem] mx-auto space-y-6 md:space-y-0"
  >
    <!-- Prev Button (desktop) -->
    <button
      id="prevBtn"
      aria-label="Previous testimonial"
      class="hidden md:flex absolute left-0 top-1/2 transform -translate-y-1/2"
      type="button"
    >
      <img
        src="{{ '/assets/images/icons/arrow.png' | relative_url }}"
        alt="Left Arrow Icon"
        loading="lazy"
        class="w-10 h-10 object-contain"
      />
    </button>

    <!-- Testimonials container -->
    <div
      id="testimonialContainer"
      class="relative flex-1 w-full max-w-full xs:max-w-4xl text-center"
      style="min-height: 400px"
    >
      {% for t in page.guest_testimonials.testimonials %}
      <article
        class="testimonial-item absolute inset-0 w-full max-w-full transition-opacity duration-500 ease-in-out"
        style="{% unless forloop.first %}opacity: 0; pointer-events: none; display: none;{% else %}opacity: 1; pointer-events: auto; position: relative; display: block;{% endunless %}"
        data-index="{{ forloop.index0 }}"
      >
        <p
          class="section-title-font mb-6 md:mb-12 text-raisin-black max-w-full break-words"
        >
          "{{ t.main_quote }}"
        </p>

        <div
          class="flex justify-center mb-4 space-x-1 text-keppel text-sm xs:text-base sm:text-lg md:text-xl"
          aria-label="Rating: {{ t.rating }} stars"
        >
          {% for i in (1..5) %} {% if i <= t.rating %}
          <span>★</span>
          {% else %}
          <span>☆</span>
          {% endif %} {% endfor %}
        </div>
        <p
          class="description-font mb-6 max-w-full xs:max-w-3xl mx-auto text-raisin-black"
        >
          {{ t.description }}
        </p>
        <p class="description-bold description-font mb-1 text-raisin-black">
          {{ t.name }}
        </p>
        <p class="description-font text-raisin-black mb-6">{{ t.date }}</p>
        <button
          class="description-font description-semibold underline text-raisin-black hover:text-raisin-black-hover focus:outline-none"
          type="button"
          aria-label="View all reviews"
        >
          <a href="">View all reviews</a>
        </button>
      </article>
      {% endfor %}
    </div>

    <!-- Next Button (desktop) -->
    <button
      id="nextBtn"
      aria-label="Next testimonial"
      class="hidden md:flex absolute right-0 top-1/2 transform -translate-y-1/2 rotate-180"
      type="button"
    >
      <img
        src="{{ '/assets/images/icons/arrow.png' | relative_url }}"
        alt="Right Arrow Icon"
        loading="lazy"
        class="w-10 h-10 object-contain"
      />
    </button>
  </div>

  <!-- Mobile arrows container (only show below 768px) -->
  <div
    id="mobileArrows"
    class="flex md:hidden px-4 mt-6 justify-center space-x-6"
  >
    <button id="mobilePrevBtn" aria-label="Previous testimonial" type="button">
      <img
        src="{{ '/assets/images/icons/arrow.png' | relative_url }}"
        alt="Left Arrow Icon"
        loading="lazy"
        class="object-contain w-6 h-6"
      />
    </button>
    <button id="mobileNextBtn" aria-label="Next testimonial" type="button">
      <img
        src="{{ '/assets/images/icons/arrow.png' | relative_url }}"
        alt="Right Arrow Icon"
        loading="lazy"
        class="object-contain rotate-180 w-6 h-6"
      />
    </button>
  </div>

  <script>
    window.addEventListener("load", () => {
      const container = document.getElementById("testimonialContainer");
      const items = container.querySelectorAll(".testimonial-item");
      let maxHeight = 0;

      items.forEach((item) => {
        // Simpan style asli agar nanti dikembalikan
        const originalStyles = {
          opacity: item.style.opacity,
          pointerEvents: item.style.pointerEvents,
          position: item.style.position,
          display: item.style.display,
        };

        // Tampilkan dulu untuk ukur tinggi
        item.style.opacity = "1";
        item.style.pointerEvents = "auto";
        item.style.position = "relative";
        item.style.display = "block";

        const height = item.offsetHeight;
        if (height > maxHeight) maxHeight = height;

        // Kembalikan style asli
        item.style.opacity = originalStyles.opacity;
        item.style.pointerEvents = originalStyles.pointerEvents;
        item.style.position = originalStyles.position;
        item.style.display = originalStyles.display;
      });

      // Set minHeight container supaya tetap
      container.style.minHeight = maxHeight + "px";
    });
  </script>
</section>
